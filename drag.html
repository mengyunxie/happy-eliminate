<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>key</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no,initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
    /*全局公用样式*/
    body{margin:0;padding:0;color:#000;font-size:12px; font-family:"微软雅黑"; background:#FFF; line-height:21px;}
    form,input,div,dl,dt,dd,ul,ol,li,table,tr,th,td,textarea,form,botton,img,h1,h2,h3,h4,h5,h6,p{border:0;margin:0;padding:0;}
    img{border:0;vertical-align:top;width: auto; height: auto; max-width: 100%;}
    input[type="text"]{-webkit-appearance: none;}
    /*列表公用样式*/
    ul,li{list-style:none;}
    /*浮动公用样式*/
    .left{float:left}
    .right{float:right}
    .clear{clear:both}
    strike{ color:#8c8c8c;}
    i,h1,h2{ font-style:normal;}

    .tableBox{
        position:relative;
        width:300px;
        height:300px;
        border:1px solid #eee;
        margin:20px auto;
    }
    .row{
        width:100%;
        height:60px;
        overflow:hidden;
    }
    .cell{
        float:left;
        width:58px;
        height:58px;
        line-height:58px;
        margin:1px 1px;
        text-align:center;
        border-radius:3px;
    }
    .cell.type0{
        background-color:#e8c646;
    }
    .cell.type1{
        background-color:#52bf52;
    }
    .cell.type2{
        background-color:#6e6ce8;
    }
    .cell.type3{
        background-color:#e47be4;
    }
    .cell.type4{
        background-color:#42d6d6;
    }

    </style>
    </head>
    <body>
<!--       <div class="tableBox" id="tableBox">
        <div class="row">
          <div class="cell dragEle type0"></div>
          <div class="cell dragEle type1"></div>
          <div class="cell dragEle type4"></div>
          <div class="cell dragEle type3"></div>
          <div class="cell dragEle type1"></div>
        </div>
        <div class="row">
          <div class="cell dragEle type1"></div>
          <div class="cell dragEle type1"></div>
          <div class="cell dragEle type3"></div>
          <div class="cell dragEle type4"></div>
          <div class="cell dragEle type2"></div>
        </div>
        <div class="row">
          <div class="cell dragEle type2"></div>
          <div class="cell dragEle type2"></div>
          <div class="cell dragEle type4"></div>
          <div class="cell dragEle type2"></div>
          <div class="cell dragEle type2"></div>
        </div>
        <div class="row">
          <div class="cell dragEle type0"></div>
          <div class="cell dragEle type1"></div>
          <div class="cell dragEle type4"></div>
          <div class="cell dragEle type3"></div>
          <div class="cell dragEle type1"></div>
        </div>
        <div class="row">
          <div class="cell dragEle type1"></div>
          <div class="cell dragEle type4"></div>
          <div class="cell dragEle type2"></div>
          <div class="cell dragEle type2"></div>
          <div class="cell dragEle type1"></div>
        </div>
      </div> -->
    </body>
    <script type="text/javascript">
    var ROW_MAX = 5;
    var COL_MAX = 5;
    var initArr1 = [[3,4,2,2,2],
                    [1,4,0,4,2],
                    [3,3,3,1,0],
                    [3,2,4,2,1],
                    [3,4,0,1,3]];
    var startPositoin ={
        x:0,
        y:0,
        time:0
    };
    
    var displacementX = 0 , displacementY = 0 , displacementXABS = 0,displacementYABS = 0;
    function initDemo(arrParams){
        var index = 0;
        var tableDemo = document.createElement('div'); 
        tableDemo.className = 'tableBox';
        tableDemo.setAttribute("id","tableBox");
        var cellDemo = '';
        for(var row =0;row<ROW_MAX;row++){
            for(var col =0;col<COL_MAX;col++){
              cellDemo +='<div class="cell dragEle type'+arrParams[row][col]+'" data-index="'+index+'">'+arrParams[row][col]+'</div>';
              index++;
            }    
        }
        tableDemo.innerHTML = cellDemo;
        document.body.appendChild(tableDemo);
    }
    initDemo(initArr1);
    var oriObj = document.getElementById("tableBox");
    oriObj.addEventListener('touchstart', touchS, false );
    oriObj.addEventListener('touchmove',touchM ,  false);
    oriObj.addEventListener('touchend', touchE, false);

    function touchS(ev){
        var ev = ev || window.event;
　　　　var target = ev.target || ev.srcElement;
        var className = target.className;

        if(className.indexOf("dragEle") != -1){
            if(ev.touches.length == 1){
               startPositoin.x = ev.touches[0].pageX;
               startPositoin.y = ev.touches[0].pageY;
               startPositoin.time = new Date();
            }
        }
    }
    function touchM(ev){
        var ev = ev || window.event;
　　　　var target = ev.target || ev.srcElement;
        var className = target.className;
        var targetWidth = target.offsetWidth,targetHeight = target.offsetHeight;
        if(className.indexOf("dragEle") != -1){ 
            if(ev.touches.length == 1){
                displacementX = ev.touches[0].pageX - startPositoin.x;
                displacementY = ev.touches[0].pageY - startPositoin.y;
                displacementXABS = Math.abs( displacementX );
                displacementYABS = Math.abs( displacementY );

                if((displacementXABS >= ( targetWidth*0.5 ) && displacementXABS <=( targetWidth*1.5 ) ) || ( displacementYABS >= ( targetHeight*0.5 ) && displacementYABS <= ( targetHeight*1.5 ) )){
                    //console.log("create");
                    //target.style.left = ev.touches[0].pageX + 'px';
                    //target.style.top = ev.touches[0].pageY + 'px';

                }
                if(displacementXABS > ( targetWidth*1.5 )|| displacementYABS > ( targetHeight*1.5 )){
                    //console.log("clear");
                }

            }
        }
        ev.preventDefault();
    }
    function touchE(ev){
        var ev = ev || window.event;
　　　　var target = ev.target || ev.srcElement;
        var className = target.className;
        var targetWidth = target.offsetWidth,targetHeight = target.offsetHeight;
        var parentEle = null , exEle = null , exEleClass = '';
        var targetIndex = 0 , exIndex = -1;
        var upFlag = true , downFlag = true , leftFlag = true , rightFlag = true ;
        if(className.indexOf("dragEle") != -1){
            if(ev.changedTouches.length == 1){
                displacementX = ev.changedTouches[0].pageX - startPositoin.x;
                displacementY = ev.changedTouches[0].pageY - startPositoin.y;
                displacementXABS = Math.abs( displacementX );
                displacementYABS = Math.abs( displacementY );
                parentEle = target.parentElement;
                for(var i = 0 ; i<parentEle.childNodes.length ; i++){
                    if( parentEle.childNodes[i].nodeType == 1){
                        if(parentEle.childNodes[i].dataset.index == target.dataset.index){
                            targetIndex = target.dataset.index;
                            if(targetIndex < COL_MAX){
                                //第一行
                                upFlag = false;
                            }
                            if( (targetIndex%COL_MAX) == 0){
                                //最左列
                                leftFlag = false;
                            }
                            if( (targetIndex%COL_MAX) == (COL_MAX-1) ){
                                //最右列
                                rightFlag = false;
                            }
                            if((targetIndex >= COL_MAX*(ROW_MAX-1)) && (targetIndex < COL_MAX*ROW_MAX)){
                                //最后一行
                                downFlag = false;
                            }
                        }
                    }
                }

                if((displacementXABS >= ( targetWidth*0.5 ) && displacementXABS <=( targetWidth*1.5 ) ) || ( displacementYABS >= ( targetHeight*0.5 ) && displacementYABS <= ( targetHeight*1.5 ) )){  
                    //向上
                    if((displacementY<0&&displacementX>0&&displacementYABS>displacementXABS)||(displacementY<0&&displacementX<0&&displacementYABS>displacementXABS)){
                        if(upFlag){
                           console.log("向上");
                           exIndex =  parseInt(targetIndex, 10) - COL_MAX;
                        } 
                    }
                    //向下
                    if((displacementY>0&&displacementX<0&&displacementYABS>displacementXABS)||(displacementY>0&&displacementX>0&&displacementYABS>displacementXABS)){
                        if(downFlag){
                           console.log("向下"); 
                           exIndex =  parseInt(targetIndex, 10) + COL_MAX;
                        }
                    }
                    //向右
                    if((displacementY<0&&displacementX>0&&displacementYABS<displacementXABS)||(displacementY>0&&displacementX>0&&displacementYABS<displacementXABS)){
                        if(rightFlag){
                           console.log("向右"); 
                           exIndex =  parseInt(targetIndex, 10) + 1;
                        }
                    }
                    //向左
                    if((displacementY<0&&displacementX<0&&displacementYABS<displacementXABS)||(displacementY>0&&displacementX<0&&displacementYABS<displacementXABS)){
                        if(leftFlag){
                           console.log("向左"); 
                           exIndex =  parseInt(targetIndex, 10) - 1;
                        }
                    }  
                }
                
                if(exIndex >= 0){
                    //交换
                    for(var m = 0 ; m <parentEle.childNodes.length ; m++){
                        if(parentEle.childNodes[m].dataset.index == targetIndex){
                            exEleClass = parentEle.childNodes[m].className;
                            exEle = parentEle.childNodes[m].innerHTML;
                            break;
                        }  
                    }
                    for(var n = 0 ; n <parentEle.childNodes.length ; n++){
                        if(parentEle.childNodes[n].dataset.index == exIndex){
                            target.className = parentEle.childNodes[n].className;
                            target.innerHTML = parentEle.childNodes[n].innerHTML;
                            parentEle.childNodes[n].className = exEleClass;
                            parentEle.childNodes[n].innerHTML = exEle;
                            break;
                        }  
                    }

                }

            }
        }
    }
        
    </script>
    </html> 